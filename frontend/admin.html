<style type="text/css">
td,th
{
    padding:0 15px 0 15px;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.theme.min.css">-->
<script src="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.js"></script>
<link rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.css">
<table id="list" style="max-width:50%; float: left;"></table>
<div id="map" style="width: 50%; height: 100%; float: right;"></div>
<script src="common.js"></script>
<script>
	map.on('click',function(event) {
		console.log(event)
		position=event.latlng
		adres=prompt('Wat is het adres van deze container?')
		if(adres) {
			addContainer(position.lat,position.lng,adres,function (id) {
				if(id) alert('Het nummer van de container is '+id+'.')
				else alert('er is iets fout gegaan bij het aanmaken van de container.')
			})
		}
	})
	$(document).on('click','tr',function (event) {
		id=$(event.currentTarget).attr('containerid')
		if(!id) return
		if(confirm('wil je container '+id+' echt verwijderen?')) {
			deleteContainer(id,function (success) {
				if(success) alert('verwijderen van container '+id+' gelukt.')
				else alert('verwijderen van container '+id+' niet gelukt. ververs de pagina en probeer het opnieuw.')
			})
		}
	})
	function postData(data,callback) {
		$.post(serverUrl,JSON.stringify(data),function(data) {
			updateContainers()
			callback(data)
		},'json')
	}
	function addContainer(lat,lng,adres,callback) {
		postData({lat:lat,lng:lng,adres:adres},function(data){
			if(data.id) callback(data.id)
			else callback()
			updateContainers()
		})
	}
	function deleteContainer(id,callback) {
		postData({action:"delete",id:id},function(data){
			callback(data.status=="OK")
		})
	}
</script>
